<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon/apple-touch-icon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"amyangfei.me","root":"/","images":"/images","scheme":"Mist","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="This article will first talk about a wrong use case with etcd lease, and then based on that case, I will dig into the design principle of etcd lease and some use scenario with etcd lease. A wrong use">
<meta property="og:type" content="article">
<meta property="og:title" content="Thinking about etcd lease">
<meta property="og:url" content="http://amyangfei.me/2020/12/27/thinking-about-etcd-lease/index.html">
<meta property="og:site_name" content="Amyangfei&#39;s Blog">
<meta property="og:description" content="This article will first talk about a wrong use case with etcd lease, and then based on that case, I will dig into the design principle of etcd lease and some use scenario with etcd lease. A wrong use">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-12-27T00:00:00.000Z">
<meta property="article:modified_time" content="2020-12-27T13:52:42.561Z">
<meta property="article:author" content="amyangfei">
<meta property="article:tag" content="golang">
<meta property="article:tag" content="etcd">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://amyangfei.me/2020/12/27/thinking-about-etcd-lease/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>Thinking about etcd lease | Amyangfei's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-30252000-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-30252000-1');
      }
    </script>



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Amyangfei's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Amyangfei's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Enjoy Programming</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-wrong-use-case-with-etcd-lease"><span class="nav-number">1.</span> <span class="nav-text">A wrong use case with etcd lease</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dig-into-the-implement-principle-of-etcd-lease"><span class="nav-number">2.</span> <span class="nav-text">Dig into the implement principle of etcd lease</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#When-and-how-to-use-etcd-lease"><span class="nav-number">3.</span> <span class="nav-text">When and how to use etcd lease</span></a></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">amyangfei</p>
  <div class="site-description" itemprop="description">我的个人博客，会在这里记录学习、工作过程中遇到的问题和对技术的思考。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/amyangfei" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;amyangfei" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/amyangfei" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;amyangfei" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://amyangfei.me/2020/12/27/thinking-about-etcd-lease/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="amyangfei">
      <meta itemprop="description" content="我的个人博客，会在这里记录学习、工作过程中遇到的问题和对技术的思考。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Amyangfei's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Thinking about etcd lease
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-12-27 00:00:00" itemprop="dateCreated datePublished" datetime="2020-12-27T00:00:00+00:00">2020-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/program/" itemprop="url" rel="index"><span itemprop="name">program</span></a>
        </span>
    </span>

  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>4.6k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>6 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>This article will first talk about a wrong use case with etcd lease, and then based on that case, I will dig into the design principle of etcd lease and some use scenario with etcd lease.</p>
<h2 id="A-wrong-use-case-with-etcd-lease"><a href="#A-wrong-use-case-with-etcd-lease" class="headerlink" title="A wrong use case with etcd lease"></a>A wrong use case with etcd lease</h2><p>There exist two roles in the following scenario, one is client and the other one is coordinator. More than one clients could exist at the same time. Each of them has an unique ID, and when a new client starts it applies a new lease from etcd and puts a key corresponding to the client ID with lease as option. The client must call <code>KeepAlive</code> of its lease periodically to keep lease not timeout. Once the lease is timeout and deleted by etcd server, the client becomes illegal and should not access the etcd resource anymore. The coordinator monits the client ID key, when a new client registers, it allocates new resource/task to this client, which can be represented by a client ID relevant key value. And when it detects client ID key deleted (which means the client lease timeout), it will recycle the allocated resource of this client.</p>
<p>Here we use a etcd session to maintain client lease and lease keepalive, a simple work model of client is as follows</p>
<a id="more"></a>

<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">session, err := concurrency.NewSession(etcdCli, concurrency.WithTTL(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-session.Done():</span><br><span class="line">        <span class="comment">// lease is timeout, client exits</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">case</span> ev := &lt;-etcdCli.Watch(ctx, resourceKey):</span><br><span class="line">        <span class="comment">// process resource update, mainly some etcd key value operations</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the above code, <code>session.Done</code> is used for lease aliveness check. However this is not a strict aliveness protection for resource access for two reasons.</p>
<ol>
<li><p>after client receives a new update from watch chan, during the process procedure of resource update, the client’s lease could be timeout, which means the client could still access the resource after it is illegal.</p>
</li>
<li><p>the <code>session.Done</code> for a lease is not real time, which means when the lease is timeout, the <code>session.Done</code> channel may be not fired immediately. This is because <code>session.Done</code> is only notified when etcd client establish a new keepalive request, there could be a time window as long as 1/3 of session ttl that <code>session.Done</code> is not notified even the lease is already revoked.</p>
</li>
</ol>
<p>The goal of aliveness guarantee for resouce access can be achieved by using etcd <code>Txn</code> simply. As there exists a key bounded with client lease, the client can make use of this key to guarantee lease is timeout during other etcd key value operations. The main logic can be as follows.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ErrLeaseTimeout := errors.New(<span class="string">&quot;lease associated key is deleted&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">alivenessGuaranteeAccess</span><span class="params">(ctx context.Context, leasedKey, resourceKey <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    resp, err := cli.Get(ctx, leasedKey)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> resp.Count == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrLeaseTimeout</span><br><span class="line">    &#125;</span><br><span class="line">    revision := resp.Kvs[<span class="number">0</span>].ModRevision</span><br><span class="line">    txnResp, err := etcdCli.Txn(ctx).If(</span><br><span class="line">        clientv3.Compare(clientv3.ModRevision(leasedKey), <span class="string">&quot;=&quot;</span>, revision),</span><br><span class="line">    ).Then(</span><br><span class="line">        clientv3.OpPut(resourceKey, <span class="string">&quot;new value&quot;</span>),</span><br><span class="line">    ).Commit()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !txnResp.Succeeded &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrLeaseTimeout</span><br><span class="line">    &#125;</span><br><span class="line">    log.Info(<span class="string">&quot;update resource key successfully&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dig-into-the-implement-principle-of-etcd-lease"><a href="#Dig-into-the-implement-principle-of-etcd-lease" class="headerlink" title="Dig into the implement principle of etcd lease"></a>Dig into the implement principle of etcd lease</h2><p>In this part I will talk about the implement principle of etcd lease based on code in <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/tree/v3.4.14">tag-3.4.14</a>. Basically, each etcd server runs a lease manager which implements the <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/lease/lessor.go#L82">Lessor</a> interface. Most of the lease management is via raft to keep lease information consistent among multiple etcd servers. Take the lease grant operation as an example. When a <code>LeaseGrantRequest</code> is received by etcd server, the gRPC request will be processed in <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/v3.4.14/etcdserver/api/v3rpc/lease.go#L39">LeaseGrant</a> of a lease serverand return <code>LeaseRevokeResponse</code> after processing. When processing the LeaseGrantRequest, it will be passed to <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/etcdserver/v3_server.go#L247">LeaseGrant</a> function of <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/etcdserver/v3_server.go#L53">EtcdServer/Lessor</a> to trigger an internal raft request. Then raft message will be applied via the <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/etcdserver/v3_server.go#L609">internal raft mechanism</a> to all servers. When <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/etcdserver/apply.go#L137">applying the <code>LeaseGrant</code> message</a> in each etcd server, The <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/lease/lessor.go#L258">Grant</a> function of a <code>Lessor</code> will be finally called.</p>
<p>The main event loop of a <code>Leasor</code> contains two periodic jobs, <code>revokeExpiredLeases</code> and <code>checkpointScheduledLeases</code>.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/lease/lessor.go#L601">revokeExpiredLeases</a> finds all leases past their expiry and sends them to an expired channel for revoking, the channel is consumed in <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/etcdserver/server.go#L1061">etcd server’s main loop</a>. Each lease is associated with a <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/lease/lease_queue.go#L22">LeaseItem</a> and all lease items are stored in a <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/lease/lease_queue.go#L63">min heap</a>, the heap item is sorted by the expiration time of lease. When I was reading the code about iterating the expiration heap, I found an interesting code snippet, each time the lessor pops an expired item from the heap, it will <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/lease/lessor.go#L679-L681">put back a new lease item with the same lease ID but adding an <code>expiredLeaseRetryInterval</code> to the expired time</a>. This is a patched logic to fix a bug that if the receiver of expired channel does not revoke lease successfully, the lease will be never revokded because it can’t be retrieved from lease expiration heap anymore. More details can be found in <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/pull/10693">this PR</a>.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/blob/8a03d2e9614b8192ebaa5a25ef92f6ff62e3593c/lease/lessor.go#L589">checkpointScheduledLeases</a> was introduced since etcd 3.4 in <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/pull/9924">this PR</a>, this PR has described the requirement and mechanism of <code>lease checkpointing</code> detailedly. It is designed for the scenario that one etcd leader is transfered, the new leader will rebuild lease information and inherit the remaining ttl of existings leases instead of auto-renew to their full TTL.</li>
</ul>
<h2 id="When-and-how-to-use-etcd-lease"><a href="#When-and-how-to-use-etcd-lease" class="headerlink" title="When and how to use etcd lease"></a>When and how to use etcd lease</h2><p>TO be continued</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/golang/" rel="tag"># golang</a>
              <a href="/tags/etcd/" rel="tag"># etcd</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/12/19/best-practice-with-go-etcd/" rel="prev" title="Some best practices with go etcd library">
                  <i class="fa fa-chevron-left"></i> Some best practices with go etcd library
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">amyangfei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  







  






<script>
  var disqus_config = function() {
    this.page.url = "http://amyangfei.me/2020/12/27/thinking-about-etcd-lease/";
    this.page.identifier = "2020/12/27/thinking-about-etcd-lease/";
    this.page.title = "Thinking about etcd lease";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://amyangfei.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
